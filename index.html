<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>estuary-rpc-proj</title><meta name="description" content="Documentation for estuary-rpc-proj"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os"</script><header class="tsd-page-toolbar">
<div class="tsd-toolbar-contents container">
<div class="table-cell" id="tsd-search" data-base=".">
<div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M15.7824 13.833L12.6666 10.7177C12.5259 10.5771 12.3353 10.499 12.1353 10.499H11.6259C12.4884 9.39596 13.001 8.00859 13.001 6.49937C13.001 2.90909 10.0914 0 6.50048 0C2.90959 0 0 2.90909 0 6.49937C0 10.0896 2.90959 12.9987 6.50048 12.9987C8.00996 12.9987 9.39756 12.4863 10.5008 11.6239V12.1332C10.5008 12.3332 10.5789 12.5238 10.7195 12.6644L13.8354 15.7797C14.1292 16.0734 14.6042 16.0734 14.8948 15.7797L15.7793 14.8954C16.0731 14.6017 16.0731 14.1267 15.7824 13.833ZM6.50048 10.499C4.29094 10.499 2.50018 8.71165 2.50018 6.49937C2.50018 4.29021 4.28781 2.49976 6.50048 2.49976C8.71001 2.49976 10.5008 4.28708 10.5008 6.49937C10.5008 8.70852 8.71314 10.499 6.50048 10.499Z" fill="var(--color-text)"></path></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div>
<ul class="results">
<li class="state loading">Preparing search index...</li>
<li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">estuary-rpc-proj</a></div>
<div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="7" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="11" width="14" height="2" fill="var(--color-text)"></rect></svg></a></div></div></header>
<div class="container container-main">
<div class="col-8 col-content">
<div class="tsd-page-title">
<h2>estuary-rpc-proj</h2></div>
<div class="tsd-panel tsd-typography"><img align="center" alt="Estuary-RPC" src="https://user-images.githubusercontent.com/4743325/187093151-ce7dae3b-6893-4276-a889-4e2469881b17.png" />
<p align="center">
  <a href="https://github.com/digitaltembo/estuary-rpc/actions/workflows/builld-and-deploy.yaml">
    <img alt="Build & Deploy" 
         src="https://github.com/digitaltembo/estuary-rpc/actions/workflows/builld-and-deploy.yaml/badge.svg">
  </a>
  <a href="https://digitaltembo.github.io/estuary-rpc/coverage/">
    <img alt="Coverage" 
         src="https://img.shields.io/endpoint?url=https://digitaltembo.github.io/estuary-rpc/coverage.json">
  </a>
  <a href="https://www.npmjs.com/package/estuary-rpc">
    <img alt="npm"
         src="https://img.shields.io/npm/v/estuary-rpc">
  </a>
  <a href="https://digitaltembo.github.io/estuary-rpc/">
    <img alt="Documentation" 
         src="https://img.shields.io/static/v1?label=docs&message=passing&color=brightgreen">
  </a>
</p>

<p>Estuary RPC is an attempt to make an extremely simple RPC system in TypeScript for use between browsers and Node.js servers that:</p>
<ul>
<li>is typesafe, with all types simply defined in TypeScript - meaning your code won&#39;t compile if the server or the client code is not invoked with the correct types for the given RPC call</li>
<li>supports most desired operations between client and server (REST methods, WebSocket streams, status codes, file uploads, automatic authentication) transparently with respect to the function calls and definitions</li>
<li>doesn&#39;t have external dependencies</li>
</ul>
<p>As a system, Estuary RPC replaces</p>
<ul>
<li>clientside calls to <code>fetch</code>, <code>new XmlHttpRequest()</code>, and <code>new WebSocket()</code> - all such calls just go through a typesafe client object</li>
<li>serverside use of <code>Express</code> and other http servers, <code>ws</code> and other WebSocket server, <code>multer</code>/<code>busboy</code> and other file/form parsing libraries</li>
<li>full rpc solutions such as <code>gRPC</code></li>
</ul>
<p>It is NOT and does not endeavor to be a web-framework, specifically being extremely unopinionated about UI frameworks (you just need JS), security (it will parse security tokens from requests, but deciding what to do with them is up to you), or databases.</p>
<p>It was inspired by me passing a JSON object <code>{&quot;heightCM&quot;: 123}</code> to a server when <code>{&quot;height&quot;: 123}</code> was needed, and being quite frustrated by the fact that <em>the main benefit</em> of using a JS backend is to share types with the frontend, but rarely are the types living on the interface actually enforced.</p>

<a href="#sample-code" id="sample-code" style="color: inherit; text-decoration: none;">
  <h2>Sample Code</h2>
</a>
<p>As a quick taste, here is how to define a complete typesafe client and server in estuary-rpc:</p>

<a href="#common-code" id="common-code" style="color: inherit; text-decoration: none;">
  <h3>Common Code</h3>
</a>
<pre><code class="language-ts"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">Api</span><span class="hl-1">, </span><span class="hl-2">Endpoint</span><span class="hl-1">, </span><span class="hl-2">get</span><span class="hl-1">, </span><span class="hl-2">SimpleMeta</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;estuary-rpc&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">// define metadata for your interface, to be used by client and server</span><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">myApiMeta</span><span class="hl-1">: </span><span class="hl-7">MyApi</span><span class="hl-1">&lt;</span><span class="hl-7">unknown</span><span class="hl-1">, </span><span class="hl-7">SimpleMeta</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">  </span><span class="hl-4">// foo will be an endpoint that takes a number, returns a string, and will be translated into </span><br/><span class="hl-1">  </span><span class="hl-4">// a GET request with the number sent over URL form encoding to the url /foo</span><br/><span class="hl-1">  </span><span class="hl-2">foo:</span><span class="hl-1"> </span><span class="hl-8">get</span><span class="hl-1">&lt;</span><span class="hl-7">number</span><span class="hl-1">, </span><span class="hl-7">string</span><span class="hl-1">&gt;(</span><span class="hl-3">&quot;foo&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-5">type</span><span class="hl-1"> </span><span class="hl-7">MyApi</span><span class="hl-1">&lt;</span><span class="hl-7">Closure</span><span class="hl-1">, </span><span class="hl-7">Meta</span><span class="hl-1">&gt; = </span><span class="hl-7">ApiTypeOf</span><span class="hl-1">&lt;</span><span class="hl-7">Closure</span><span class="hl-1">, </span><span class="hl-7">Meta</span><span class="hl-1">, </span><span class="hl-5">typeof</span><span class="hl-1"> </span><span class="hl-2">myApiMeta</span><span class="hl-1">&gt;;</span><br/>
</code></pre>

<a href="#server-code" id="server-code" style="color: inherit; text-decoration: none;">
  <h3>Server Code</h3>
</a>
<pre><code class="language-ts"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">ApiContext</span><span class="hl-1">, </span><span class="hl-2">createApiServer</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;estuary-rpc-server&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">// endpoint definitions</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">myService</span><span class="hl-1">: </span><span class="hl-7">MyApi</span><span class="hl-1">&lt;</span><span class="hl-7">ApiContext</span><span class="hl-1">, </span><span class="hl-7">unknown</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">  </span><span class="hl-8">foo</span><span class="hl-2">:</span><span class="hl-1"> (</span><span class="hl-2">num</span><span class="hl-1">: </span><span class="hl-7">number</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-3">`Server says: </span><span class="hl-5">${</span><span class="hl-2">num</span><span class="hl-5">}</span><span class="hl-3">`</span><span class="hl-1">,</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-4">// Start listening</span><br/><span class="hl-8">createApiServer</span><span class="hl-1">(</span><span class="hl-2">myService</span><span class="hl-1">, </span><span class="hl-2">myApiMeta</span><span class="hl-1">, { </span><span class="hl-2">port:</span><span class="hl-1"> </span><span class="hl-9">8080</span><span class="hl-1"> });</span>
</code></pre>

<a href="#client-code" id="client-code" style="color: inherit; text-decoration: none;">
  <h3>Client Code</h3>
</a>
<pre><code class="language-ts"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">createApiClient</span><span class="hl-1">, </span><span class="hl-2">FetchOpts</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;estuary-rpc-client&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">client</span><span class="hl-1"> = </span><span class="hl-8">createApiClient</span><span class="hl-1">(</span><span class="hl-2">myApiMeta</span><span class="hl-1">) </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-7">MyApi</span><span class="hl-1">&lt;</span><span class="hl-7">FetchOpts</span><span class="hl-1">, </span><span class="hl-7">SimpleMeta</span><span class="hl-1">&gt;;</span><br/><br/><span class="hl-4">// logs &quot;Server says: 4&quot;</span><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-8">log</span><span class="hl-1">(</span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">client</span><span class="hl-1">.</span><span class="hl-8">foo</span><span class="hl-1">(</span><span class="hl-9">4</span><span class="hl-1">));</span>
</code></pre>

<a href="#detailed-usage" id="detailed-usage" style="color: inherit; text-decoration: none;">
  <h2>Detailed Usage</h2>
</a>
<ol>
<li>Install into server and client projects: <code>npm i estuary-rpc estuary-rpc-server</code> on the server, <code>npm i estuary-rpc estuary-rpc-client</code> on the client</li>
<li>Implement common code:<ol>
<li>Define your API interface type as a generic type with Closure and Metadata generic types, extending <a href="http://digitaltembo.github.io/estuary-rpc/interfaces/estuary_rpc.Api.html">Api</a> from the estuary-rpc package</li>
<li>(Optional) Define the metadata type you would like to describe endpoints with. If you don&#39;t need to expand beyond the functionalities provided by estuary-rpc, just using <a href="http://digitaltembo.github.io/estuary-rpc/interfaces/estuary_rpc.SimpleMeta.html">SimpleMeta</a> from the estuary-rpc package is sufficient<ul>
<li>This is where you decide the groupings of RPC endpoints and types of individual endpoints</li>
<li>Each endpoint should be defined as an <a href="http://digitaltembo.github.io/estuary-rpc/types/estuary_rpc.Endpoint.html">Endpoint&lt;SomeReq, SomeRes, Closure, Meta&gt;</a> type, or if it the endpoint streams data to/from the server, a <a href="http://digitaltembo.github.io/estuary-rpc/types/estuary_rpc.StreamEndpoint.html">StreamEndpoint&lt;SomeReq, SomeRes, Closure, Meta&gt;</a>.</li>
</ul>
</li>
<li>Define your API metadata as an object instantiation of your API interface type, with the generics instantiated with an unknown Closure and your custom Metadata<ul>
<li>Use the <a href="http://digitaltembo.github.io/estuary-rpc/functions/estuary_rpc.get.html">get</a>, <a href="http://digitaltembo.github.io/estuary-rpc/functions/estuary_rpc.post.html">post</a>, <a href="http://digitaltembo.github.io/estuary-rpc/functions/estuary_rpc.put.html">put</a>, <a href="http://digitaltembo.github.io/estuary-rpc/functions/estuary_rpc.del.html">del</a>, or <a href="http://digitaltembo.github.io/estuary-rpc/functions/estuary_rpc.ws.html">ws</a> functions to easily create the endpoints that you want</li>
</ul>
</li>
</ol>
</li>
<li>In the server project<ol>
<li>Define your server as an object instantiation of your API interface type, with the generics instantiated to have a Closure of <a href="http://digitaltembo.github.io/estuary-rpc/types/estuary_rpc_server.ApiContext.html">ApiContext</a> and your Metadata type</li>
<li>Call <a href="http://digitaltembo.github.io/estuary-rpc/functions/estuary_rpc_server.createApiServer.html">createApiServer</a> with your server object, your API metadata object, and <a href="http://digitaltembo.github.io/estuary-rpc/types/estuary_rpc_server.ServerOpts.html">ServerOpts</a> to start the server</li>
</ol>
</li>
<li>In the client program, create your estuary-rpc Client object by calling <a href="http://digitaltembo.github.io/estuary-rpc/functions/estuary_rpc_client.createApiClient.html">createApiClient</a> with your API metadata object<ul>
<li>You can also pass any additional <a href="http://digitaltembo.github.io/estuary-rpc/types/estuary_rpc_client.ClientOpts.html">ClientOpts</a> here, such as <a href="http://digitaltembo.github.io/estuary-rpc/types/estuary_rpc.Authentication.html">Authentication information</a> to be passed with all requests</li>
</ul>
</li>
</ol>
<p>At either end, you may also want to call <a href="http://digitaltembo.github.io/estuary-rpc/functions/estuary_rpc.createOpenApiSpec.html">createOpenApiSpec</a> to create an OpenAPI compatible JSON blob, for use in documentation tools such as <a href="https://github.com/swagger-api/swagger-ui">Swagger UI</a>, <a href="https://github.com/Redocly/redoc">ReDoc</a> and others.</p>

<a href="#other-details" id="other-details" style="color: inherit; text-decoration: none;">
  <h2>Other Details</h2>
</a>

<a href="#metadata-amp-middleware" id="metadata-amp-middleware" style="color: inherit; text-decoration: none;">
  <h3>Metadata &amp; Middleware</h3>
</a>
<p>Each endpoint must also have metadata associated with it, which is accessible from the clientside or through your API Metadata definition object. This metadata must extend the <a href="http://digitaltembo.github.io/estuary-rpc/interfaces/estuary_rpc.SimpleMeta.html">SimpleMeta</a> interface:</p>
<pre><code><span class="hl-5">interface</span><span class="hl-1"> </span><span class="hl-7">SimpleMeta</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">method</span><span class="hl-1">: </span><span class="hl-7">Method</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-2">url</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-2">transport</span><span class="hl-1">?: </span><span class="hl-7">Transport</span><span class="hl-1">&lt;</span><span class="hl-7">unknown</span><span class="hl-1">, </span><span class="hl-7">unknown</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><span class="hl-2">authentication</span><span class="hl-1">?: </span><span class="hl-7">Authentication</span><span class="hl-1">;</span><br/><br/><span class="hl-1">  </span><span class="hl-4">// Used for OpenAPI docs</span><br/><span class="hl-1">  </span><span class="hl-2">example</span><span class="hl-1">?: [</span><span class="hl-10">reqBody</span><span class="hl-1">: </span><span class="hl-7">unknown</span><span class="hl-1">, </span><span class="hl-10">resBody</span><span class="hl-1">: </span><span class="hl-7">unknown</span><span class="hl-1">];</span><br/><span class="hl-1">  </span><span class="hl-2">reqSchema</span><span class="hl-1">?: </span><span class="hl-7">Schema</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-2">resSchema</span><span class="hl-1">?: </span><span class="hl-7">Schema</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-2">summary</span><span class="hl-1">?: </span><span class="hl-7">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-2">description</span><span class="hl-1">?: </span><span class="hl-7">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-2">swagger</span><span class="hl-1">?: </span><span class="hl-7">Record</span><span class="hl-1">&lt;</span><span class="hl-7">string</span><span class="hl-1">, </span><span class="hl-7">unknown</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">}</span>
</code></pre>
<p>These are defined for you automatically as you construct your API Metadata definition with the <a href="http://digitaltembo.github.io/estuary-rpc/functions/estuary_rpc.get.html">get</a>/<a href="http://digitaltembo.github.io/estuary-rpc/functions/estuary_rpc.post.html">post</a>/<a href="http://digitaltembo.github.io/estuary-rpc/functions/estuary_rpc.put.html">put</a>/<a href="http://digitaltembo.github.io/estuary-rpc/functions/estuary_rpc.del.html">del</a>/<a href="http://digitaltembo.github.io/estuary-rpc/functions/estuary_rpc.ws.html">ws</a> objects, although it is possible to override the transport and authentication values on a per-endpoint basis. If you want to use openApi, you will likely additionally want to define values for some of those fields. Lastly, it is possible to extend SimpleMeta with your own data, so you can annotate the interface however you want. After annotating the interface however you want, you may want to act upon that data - </p>
<ul>
<li>On the client side, the apiClient that is created by <a href="http://digitaltembo.github.io/estuary-rpc/functions/estuary_rpc_client.createApiClient.html">createApiClient</a> will have the metadata in the same object that you use as a function for communicating with the backend:</li>
</ul>
<pre><code><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">client</span><span class="hl-1"> = </span><span class="hl-8">createApiClient</span><span class="hl-1">(</span><span class="hl-2">myApiDef</span><span class="hl-1">);</span><br/><span class="hl-4">// prints out &quot;Calling GET /foo/bar&quot;</span><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-8">log</span><span class="hl-1">(</span><span class="hl-3">`Calling </span><span class="hl-5">${</span><span class="hl-2">client</span><span class="hl-11">.</span><span class="hl-2">fooService</span><span class="hl-11">.</span><span class="hl-2">bar</span><span class="hl-11">.</span><span class="hl-2">method</span><span class="hl-5">}</span><span class="hl-3">: </span><span class="hl-5">${</span><span class="hl-2">client</span><span class="hl-11">.</span><span class="hl-2">fooService</span><span class="hl-11">.</span><span class="hl-2">bar</span><span class="hl-11">.</span><span class="hl-2">url</span><span class="hl-5">}</span><span class="hl-3">`</span><span class="hl-1">);</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">result</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">client</span><span class="hl-1">.</span><span class="hl-2">fooService</span><span class="hl-1">.</span><span class="hl-8">bar</span><span class="hl-1">();</span>
</code></pre>
<ul>
<li>On the serverside, you can define middlewares passed into the <a href="http://digitaltembo.github.io/estuary-rpc/functions/estuary_rpc_server.createApiServer.html">createApiServer</a> method which will act before every endpoint gets called, and be able to determine whether to execute the endpoint:</li>
</ul>
<pre><code><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">serverDef</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-2">fooService:</span><span class="hl-1"> { </span><span class="hl-8">bar</span><span class="hl-2">:</span><span class="hl-1"> () </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-3">&quot;cool&quot;</span><span class="hl-1">}</span><br/><span class="hl-1">};</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">myMiddleware</span><span class="hl-1"> = (</span><span class="hl-2">context</span><span class="hl-1">: </span><span class="hl-7">ApiContex</span><span class="hl-1">, </span><span class="hl-2">meta</span><span class="hl-1">: </span><span class="hl-7">SimpleMeta</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">// block all requests from Jeff;</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1">(</span><span class="hl-2">context</span><span class="hl-1">.</span><span class="hl-2">authentication</span><span class="hl-1">?.</span><span class="hl-2">username</span><span class="hl-1"> !== </span><span class="hl-3">&quot;Jeff&quot;</span><span class="hl-1"> || </span><span class="hl-2">meta</span><span class="hl-1">.</span><span class="hl-2">url</span><span class="hl-1">.</span><span class="hl-8">contains</span><span class="hl-1">(</span><span class="hl-3">&quot;Jeff&quot;</span><span class="hl-1">)) {</span><br/><span class="hl-1">    </span><span class="hl-2">context</span><span class="hl-1">.</span><span class="hl-8">badRequest</span><span class="hl-1">(</span><span class="hl-3">&quot;No Jeff&#39;s allowed&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-5">false</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><span class="hl-8">createApiServer</span><span class="hl-1">(</span><span class="hl-2">serverDef</span><span class="hl-1">, </span><span class="hl-2">myApiDef</span><span class="hl-1">, { </span><span class="hl-2">middlewares:</span><span class="hl-1"> [</span><span class="hl-2">myMiddleware</span><span class="hl-1">]});</span>
</code></pre>

<a href="#transport-metadata" id="transport-metadata" style="color: inherit; text-decoration: none;">
  <h3>Transport Metadata</h3>
</a>
<p>The transport metadata determines the method by which the arguments to the endpoint function are encoded for underlying representation. See <a href="http://digitaltembo.github.io/estuary-rpc/types/estuary_rpc.Transport.html">the Transport type definition</a> for an elaboration of what is possible here, but basically trasnport will be one of <a href="http://digitaltembo.github.io/estuary-rpc/types/estuary_rpc.JsonTransport.html">Json</a>, <a href="http://digitaltembo.github.io/estuary-rpc/types/estuary_rpc.UrlFormTransport.html">UrlFormData</a>, <a href="http://digitaltembo.github.io/estuary-rpc/types/estuary_rpc.MultipartFormTransport.html">MultipartFormData</a> or a custom transport. GET requests default to a UrlFormData transport where the request is encoded in the query string, everything else defaults to JSON passed in the requestBody - all responses default to JSON encoded in the responseBody.</p>

<a href="#authentication-metadata" id="authentication-metadata" style="color: inherit; text-decoration: none;">
  <h3>Authentication Metadata</h3>
</a>
<p>It is fairly straightforward to build your own authentication process using a custom Metadata type to annotate how individual endpoints should be authenticated, and a custom <a href="http://digitaltembo.github.io/estuary-rpc/types/estuary_rpc_server.Middleware.html">Middleware</a> - but that is not necessarily necessary. There are builtins for simple Basic, Bearer, Cookie, query param, and custom header-based authentication schemas, that encode authentication values passed into the <a href="http://digitaltembo.github.io/estuary-rpc/functions/estuary_rpc_client.createApiClient.html">createApiClient</a> into the logical parts of the request and in turn parse those values at the server side, for usage, simply </p>
<ol>
<li>Pass an <a href="http://digitaltembo.github.io/estuary-rpc/types/estuary_rpc.Authentication.html">Authentication</a> object without the secret defined in your endpoint definition function (or alternatively, pass it as a <code>defaultAuthentication</code> in your <a href="http://digitaltembo.github.io/estuary-rpc/types/estuary_rpc_server.ServerOpts.html">ServerOpts</a> to make the server check authentication by default)</li>
<li>Pass an <a href="http://digitaltembo.github.io/estuary-rpc/types/estuary_rpc.Authentication.html">Authentication</a> object <em>with</em> the secret defined to <a href="http://digitaltembo.github.io/estuary-rpc/functions/estuary_rpc_client.createApiClient.html">createApiClient</a> on your client side</li>
</ol>
<p>Simple example:</p>
<pre><code><span class="hl-5">interface</span><span class="hl-1"> </span><span class="hl-7">MyApi</span><span class="hl-1">&lt;</span><span class="hl-7">Closure</span><span class="hl-1">, </span><span class="hl-7">Meta</span><span class="hl-1">&gt; </span><span class="hl-5">extends</span><span class="hl-1"> </span><span class="hl-7">Api</span><span class="hl-1">&lt;</span><span class="hl-7">Closure</span><span class="hl-1">, </span><span class="hl-7">Meta</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-2">foo</span><span class="hl-1">: </span><span class="hl-7">Endpoint</span><span class="hl-1">&lt;</span><span class="hl-7">string</span><span class="hl-1">, </span><span class="hl-7">string</span><span class="hl-1">, </span><span class="hl-7">Closure</span><span class="hl-1">, </span><span class="hl-7">Meta</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><span class="hl-2">bar</span><span class="hl-1">: </span><span class="hl-7">Endpoint</span><span class="hl-1">&lt;</span><span class="hl-7">string</span><span class="hl-1">, </span><span class="hl-7">string</span><span class="hl-1">, </span><span class="hl-7">Closure</span><span class="hl-1">, </span><span class="hl-7">Meta</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">}</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">myApiDef</span><span class="hl-1">: </span><span class="hl-7">MyApi</span><span class="hl-1">&lt;</span><span class="hl-7">unknown</span><span class="hl-1">, </span><span class="hl-7">SimpleMeta</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">  </span><span class="hl-2">foo:</span><span class="hl-1"> </span><span class="hl-8">get</span><span class="hl-1">(</span><span class="hl-3">&#39;foo&#39;</span><span class="hl-1">, { </span><span class="hl-2">authentication:</span><span class="hl-1"> { </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&#39;basic&#39;</span><span class="hl-1">}}),</span><br/><span class="hl-1">  </span><span class="hl-2">bar:</span><span class="hl-1"> </span><span class="hl-8">get</span><span class="hl-1">(</span><span class="hl-3">&#39;bar&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-8">createMyApiClient</span><span class="hl-1">(</span><span class="hl-2">currentAuthState</span><span class="hl-1">: {</span><span class="hl-2">username</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1">, </span><span class="hl-2">password</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1">}) {</span><br/><span class="hl-1">  </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-8">createApiClient</span><span class="hl-1">(</span><span class="hl-2">myApiDef</span><span class="hl-1">, { </span><span class="hl-2">authentication:</span><span class="hl-1"> {</span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&quot;Basic&quot;</span><span class="hl-1">, ...</span><span class="hl-2">currentAuthState</span><span class="hl-1"> } });</span><br/><span class="hl-1">}</span><br/><span class="hl-1">...</span><br/><br/><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-8">authenticate</span><span class="hl-1">(</span><span class="hl-2">auth</span><span class="hl-1">: </span><span class="hl-7">Authentication</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">auth</span><span class="hl-1">.</span><span class="hl-2">type</span><span class="hl-1"> === </span><span class="hl-3">&quot;basic&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">auth</span><span class="hl-1">.</span><span class="hl-2">username</span><span class="hl-1"> === </span><span class="hl-3">&quot;blah&quot;</span><span class="hl-1"> &amp;&amp; </span><span class="hl-2">auth</span><span class="hl-1">.</span><span class="hl-2">password</span><span class="hl-1"> === </span><span class="hl-3">&quot;blah&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  } </span><span class="hl-0">else</span><span class="hl-1"> </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">auth</span><span class="hl-1">.</span><span class="hl-2">type</span><span class="hl-1"> === </span><span class="hl-3">&quot;query&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">// perform default authentication on all endpoints not otherwise specified</span><br/><span class="hl-1">    </span><span class="hl-4">// only allowing requests with ?queryKey=awesome</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">auth</span><span class="hl-1">.</span><span class="hl-2">keyPair</span><span class="hl-1">[</span><span class="hl-9">1</span><span class="hl-1">] === </span><span class="hl-3">&quot;awesome&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><span class="hl-8">createApiServer</span><span class="hl-1">(</span><span class="hl-2">serverDefs</span><span class="hl-1">, </span><span class="hl-2">myApiDef</span><span class="hl-1">, { </span><span class="hl-2">defaultAuthentication:</span><span class="hl-1"> { </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&#39;query&#39;</span><span class="hl-1">, </span><span class="hl-2">keyPair:</span><span class="hl-1"> [</span><span class="hl-3">&#39;queryKey&#39;</span><span class="hl-1">] } })</span>
</code></pre>

<a href="#openapi" id="openapi" style="color: inherit; text-decoration: none;">
  <h3>OpenAPI</h3>
</a>
<p>The format of the metadata that you need to generate for Estuary is already pretty close to what is necessary for an OpenApi spec, which has a good amount of tooling around it - so Estuary provides a <a href="http://digitaltembo.github.io/estuary-rpc/functions/estuary_rpc.createOpenApiSpec.html">createOpenApiSpec</a> method. Minimal usage is possible by simply calling</p>
<pre><code><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">spec</span><span class="hl-1"> = </span><span class="hl-8">createOpenApiSpec</span><span class="hl-1">(</span><span class="hl-2">exampleApiMeta</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-2">info:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">title:</span><span class="hl-1"> </span><span class="hl-3">&quot;Example API&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">version:</span><span class="hl-1"> </span><span class="hl-3">&quot;foo.bar&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code></pre>
<p>and using that resultant spec in tooling provided by the swagger-ui, swagger-ui-react, or swagger-ui-dist tools. Arbitrary JSON can be added to the second argument to extend the generated spec with additional OpenApi tooling, 
such as custom components or servers, etc - <a href="https://swagger.io/docs/specification/basic-structure/">more details here</a>. Additionally, it is possible to provide specific endpoint-level metadata in your api definition, of the type</p>
<pre><code><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-4">// Simplest way to do it, provide example request/responses and Estuary will put forth a minimal description</span><br/><span class="hl-1">  </span><span class="hl-4">// of those types in a friendly way for OpenApi</span><br/><span class="hl-1">  </span><span class="hl-2">example</span><span class="hl-1">?: [</span><span class="hl-2">reqBody</span><span class="hl-1">: </span><span class="hl-2">unknown</span><span class="hl-1">, </span><span class="hl-2">resBody</span><span class="hl-1">: </span><span class="hl-2">unknown</span><span class="hl-1">];</span><br/><span class="hl-1">  </span><span class="hl-4">// Or just give proper descriptions of the Request and Response types according to the [Schema Object](https://github.com/OAI/OpenAPI-Specification/blob/main/versions/3.0.3.md#schemaObject) definition</span><br/><span class="hl-1">  </span><span class="hl-4">// Small note here - Estuary will automatically convert a Request object definition to a list of parameters</span><br/><span class="hl-1">  </span><span class="hl-4">// if the encoding type is URL_FORM_ENCODED</span><br/><span class="hl-1">  </span><span class="hl-2">reqSchema</span><span class="hl-1">?: </span><span class="hl-2">Schema</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-2">resSchema</span><span class="hl-1">?: </span><span class="hl-2">Schema</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-2">summary</span><span class="hl-1">?: </span><span class="hl-2">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-2">description</span><span class="hl-1">?: </span><span class="hl-2">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">// Or just give a proper description of the entire endpoint. Hopefully the fields above are easier to use and </span><br/><span class="hl-1">  </span><span class="hl-4">// almost fully functional</span><br/><span class="hl-1">  </span><span class="hl-2">swagger</span><span class="hl-1">?: </span><span class="hl-2">Record</span><span class="hl-1">&lt;</span><span class="hl-2">string</span><span class="hl-1">, </span><span class="hl-2">unknown</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#streams" id="streams" style="color: inherit; text-decoration: none;">
  <h3>Streams</h3>
</a>
<p>Streaming data is handled via websockets and ends up working a bit differently to the rest of the requests:</p>
<ul>
<li><a href="http://digitaltembo.github.io/estuary-rpc/types/estuary_rpc.BasicAuth.html">Basic</a>, <a href="http://digitaltembo.github.io/estuary-rpc/types/estuary_rpc.BearerAuth.html">Bearer</a>, and <a href="http://digitaltembo.github.io/estuary-rpc/types/estuary_rpc.HeaderAuth.html">Header</a> authentication schemes won&#39;t work, as you can&#39;t pass headers into a websocket request from the browser</li>
<li><a href="http://digitaltembo.github.io/estuary-rpc/types/estuary_rpc.UrlFormTransport.html">URL_FORM_DATA</a> and <a href="http://digitaltembo.github.io/estuary-rpc/types/estuary_rpc.MultipartFormTransport.html">MULTIPART_FORM_DATA</a> transports are not supported for what should be fairly clear reasons</li>
<li>Instead of conceptualizing the endpoint as a thing that takes in a request and returns a response, the endpoints are reprented as unary functions that take in a Duplex which can be read from and written to (and have events attatched)</li>
</ul>
<p>The <a href="http://digitaltembo.github.io/estuary-rpc/classes/estuary_rpc.Duplex.html">Duplex</a> object used in these functions contains two streams: <a href="http://digitaltembo.github.io/estuary-rpc/classes/estuary_rpc.Duplex.html#server">toServer</a> and <a href="http://digitaltembo.github.io/estuary-rpc/classes/estuary_rpc.Duplex.html#server">toClient</a>, representing the streams of data flowing to the server and to the client, respectively. They are probably easiest to interact with via the <a href="http://digitaltembo.github.io/estuary-rpc/classes/estuary_rpc.Duplex.html#client">client</a> and <a href="http://digitaltembo.github.io/estuary-rpc/classes/estuary_rpc.Duplex.html#server">server</a> StreamHandlers though, which have methods for writing in one direction and reading from the other. That is, when on the client side you do:</p>
<pre><code><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">streamHandler</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-8">openStreamHandler</span><span class="hl-1">(</span><span class="hl-2">client</span><span class="hl-1">.</span><span class="hl-2">foo</span><span class="hl-1">.</span><span class="hl-2">simpleStream</span><span class="hl-1">);</span><br/><br/><span class="hl-2">streamHandler</span><span class="hl-1">.</span><span class="hl-8">on</span><span class="hl-1">(</span><span class="hl-3">&quot;message&quot;</span><span class="hl-1">, (</span><span class="hl-2">val</span><span class="hl-1">: </span><span class="hl-7">boolean</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><br/><span class="hl-1">  </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-8">log</span><span class="hl-1">(</span><span class="hl-3">&quot;Got message from server&quot;</span><span class="hl-1">, </span><span class="hl-2">val</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-2">streamHandler</span><span class="hl-1">.</span><span class="hl-8">write</span><span class="hl-1">(</span><span class="hl-3">&quot;up&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-2">streamHandler</span><span class="hl-1">.</span><span class="hl-8">close</span><span class="hl-1">()</span><br/><span class="hl-1">);</span>
</code></pre>
<p><a href="http://digitaltembo.github.io/estuary-rpc/functions/estuary_rpc.openStreamHandler.html">openStreamHandler</a> returnes a <a href="http://digitaltembo.github.io/estuary-rpc/types/estuary_rpc.StreamHandler.html">StreamHandler</a> that is the client representation of a duplex created and passed to <code>client.foo.simpleStream</code>, with the message event triggering <strong>on messages from the server</strong> and the streamHandler.write event being encoded and sent in the websocket stream to the server (and the close event, in turn terminating the WS connection).</p>
<p>Likewise on the server, when you define a method it is easiest to do something like</p>
<pre><code><span class="hl-10">simpleStream</span><span class="hl-1">: </span><span class="hl-5">async</span><span class="hl-1"> ({ </span><span class="hl-2">server</span><span class="hl-1"> }: </span><span class="hl-7">Duplex</span><span class="hl-1">&lt;</span><span class="hl-7">string</span><span class="hl-1">, </span><span class="hl-7">boolean</span><span class="hl-1">&gt;) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">server</span><span class="hl-1">.</span><span class="hl-8">on</span><span class="hl-1">(</span><span class="hl-3">&quot;message&quot;</span><span class="hl-1">, (</span><span class="hl-2">input</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-8">log</span><span class="hl-1">(</span><span class="hl-3">&quot;Got message&quot;</span><span class="hl-1">, </span><span class="hl-2">input</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-2">server</span><span class="hl-1">.</span><span class="hl-8">write</span><span class="hl-1">(</span><span class="hl-2">input</span><span class="hl-1"> === </span><span class="hl-3">&quot;foo&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">},</span>
</code></pre>
<p>Where the server view of the duplex is reading from the client and writing to the server. Because the high-level design of Estuary is such that the type of the method should be the same on the client as on the server, you technically must have access to the same interface on both sides - but accessing the client interface on the server or vice versa will result in messages being written to streams that don&#39;t otherwise have listeners on them (and vice versa).</p>
</div></div>
<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
<div class="tsd-navigation settings">
<details class="tsd-index-accordion"><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Settings</h3></summary>
<div class="tsd-accordion-details">
<div class="tsd-filter-visibility">
<h4 class="uppercase">Member Visibility</h4><form>
<ul id="tsd-filter-options">
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div>
<div class="tsd-theme-toggle">
<h4 class="uppercase">Theme</h4><select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div>
<nav class="tsd-navigation primary">
<details class="tsd-index-accordion" open><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Modules</h3></summary>
<div class="tsd-accordion-details">
<ul>
<li class="current selected"><a href="modules.html">estuary-<wbr/>rpc-<wbr/>proj</a>
<ul>
<li class="tsd-kind-module"><a href="modules/estuary_rpc.html">estuary-<wbr/>rpc</a></li>
<li class="tsd-kind-module"><a href="modules/estuary_rpc_client.html">estuary-<wbr/>rpc-<wbr/>client</a></li>
<li class="tsd-kind-module"><a href="modules/estuary_rpc_server.html">estuary-<wbr/>rpc-<wbr/>server</a></li></ul></li></ul></div></details></nav></div></div>
<div class="container tsd-generator">
<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div>
<div class="overlay"></div><script src="assets/main.js"></script></body></html>