<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>estuary-rpc-proj</title><meta name="description" content="Documentation for estuary-rpc-proj"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os"</script><header class="tsd-page-toolbar">
<div class="tsd-toolbar-contents container">
<div class="table-cell" id="tsd-search" data-base=".">
<div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M15.7824 13.833L12.6666 10.7177C12.5259 10.5771 12.3353 10.499 12.1353 10.499H11.6259C12.4884 9.39596 13.001 8.00859 13.001 6.49937C13.001 2.90909 10.0914 0 6.50048 0C2.90959 0 0 2.90909 0 6.49937C0 10.0896 2.90959 12.9987 6.50048 12.9987C8.00996 12.9987 9.39756 12.4863 10.5008 11.6239V12.1332C10.5008 12.3332 10.5789 12.5238 10.7195 12.6644L13.8354 15.7797C14.1292 16.0734 14.6042 16.0734 14.8948 15.7797L15.7793 14.8954C16.0731 14.6017 16.0731 14.1267 15.7824 13.833ZM6.50048 10.499C4.29094 10.499 2.50018 8.71165 2.50018 6.49937C2.50018 4.29021 4.28781 2.49976 6.50048 2.49976C8.71001 2.49976 10.5008 4.28708 10.5008 6.49937C10.5008 8.70852 8.71314 10.499 6.50048 10.499Z" fill="var(--color-text)"></path></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div>
<ul class="results">
<li class="state loading">Preparing search index...</li>
<li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">estuary-rpc-proj</a></div>
<div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="7" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="11" width="14" height="2" fill="var(--color-text)"></rect></svg></a></div></div></header>
<div class="container container-main">
<div class="col-8 col-content">
<div class="tsd-page-title">
<h2>estuary-rpc-proj</h2></div>
<div class="tsd-panel tsd-typography">
<a href="#estuary-rpc" id="estuary-rpc" style="color: inherit; text-decoration: none;">
  <h1>Estuary RPC</h1>
</a>
<p>Estuary RPC is an attempt to make an extremely simple (toy) RPC system for use between browsers and servers that:</p>
<ul>
<li>is typesafe, with all types simply defined in TS - meaning your code won&#39;t compile if the server or the client code is not invoked with the correct types for the given RPC call</li>
<li>supports most desired operations between client and server (REST methods, status codes, file uploads, automatic authentication)</li>
<li>doesn&#39;t have external dependencies</li>
</ul>

<a href="#usage" id="usage" style="color: inherit; text-decoration: none;">
  <h2>Usage</h2>
</a>
<p>The imagined usage is in a project set up like the example project, with</p>
<pre><code><span class="hl-0">project</span><br/><span class="hl-1"> - </span><span class="hl-0">client</span><br/><span class="hl-1"> - </span><span class="hl-0">common</span><br/><span class="hl-1"> - </span><span class="hl-0">server</span>
</code></pre>
<p>directories, where there are two separate projects, one for the server running in npm and one for the client that runs on the browser, sharing the <code>common</code> directory.</p>

<a href="#usage---common" id="usage---common" style="color: inherit; text-decoration: none;">
  <h3>Usage - Common</h3>
</a>
<p>For both the server and the client projects, you must install <code>estuary-rpc</code>.</p>
<pre><code><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-0">install</span><span class="hl-1"> </span><span class="hl-0">estuary</span><span class="hl-1">-</span><span class="hl-0">rpc</span>
</code></pre>
<p>Within the common project, it will be necessary to define 3 things:</p>
<ul>
<li>The Meta type used to describe all your endpoints. It may be sufficient to use <code>import { SimpleMeta } from &quot;estuary-rpc&quot;;</code></li>
<li>The Api type used in the interface. This type can be arbitrarily nested, but each &quot;leaf&quot; field must be either <code>Endpoint&lt;[Req], [Res], Closure, Meta&gt;</code> or <code>StreamEndpoint&lt;[Req], [Res], Closure, Meta&gt;</code>, where <code>Req</code> and <code>Res</code> are specific types and <code>Closure</code> and <code>Meta</code> are genericized<ul>
<li>For instance, this would define a ExampleApi:</li>
</ul>
</li>
</ul>
<pre><code><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-3">interface</span><span class="hl-1"> </span><span class="hl-4">ExampleApi</span><span class="hl-1">&lt;</span><span class="hl-4">Closure</span><span class="hl-1">, </span><span class="hl-4">Meta</span><span class="hl-1">&gt; </span><span class="hl-3">extends</span><span class="hl-1"> </span><span class="hl-4">Api</span><span class="hl-1">&lt;</span><span class="hl-4">Closure</span><span class="hl-1">, </span><span class="hl-4">Meta</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-0">foo</span><span class="hl-1">: </span><span class="hl-4">FooService</span><span class="hl-1">&lt;</span><span class="hl-4">Closure</span><span class="hl-1">, </span><span class="hl-4">Meta</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><span class="hl-0">fileUpload</span><span class="hl-1">: </span><span class="hl-4">Endpoint</span><span class="hl-1">&lt;</span><span class="hl-4">void</span><span class="hl-1">, </span><span class="hl-4">void</span><span class="hl-1">, </span><span class="hl-4">Closure</span><span class="hl-1">, </span><span class="hl-4">Meta</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-3">interface</span><span class="hl-1"> </span><span class="hl-4">FooService</span><span class="hl-1">&lt;</span><span class="hl-4">Closure</span><span class="hl-1">, </span><span class="hl-4">Meta</span><span class="hl-1">&gt; </span><span class="hl-3">extends</span><span class="hl-1"> </span><span class="hl-4">Api</span><span class="hl-1">&lt;</span><span class="hl-4">Closure</span><span class="hl-1">, </span><span class="hl-4">Meta</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-0">simpleGet</span><span class="hl-1">: </span><span class="hl-4">Endpoint</span><span class="hl-1">&lt;</span><span class="hl-4">number</span><span class="hl-1">, </span><span class="hl-4">number</span><span class="hl-1">, </span><span class="hl-4">Closure</span><span class="hl-1">, </span><span class="hl-4">Meta</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><span class="hl-0">simpleStream</span><span class="hl-1">: </span><span class="hl-4">StreamEndpoint</span><span class="hl-1">&lt;</span><span class="hl-4">string</span><span class="hl-1">, </span><span class="hl-4">boolean</span><span class="hl-1">, </span><span class="hl-4">Closure</span><span class="hl-1">, </span><span class="hl-4">Meta</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">}</span>
</code></pre>
<ul>
<li>The Api Metadata Definition, implementing your Api type genericized over your Meta type and an unknown closure. This will use the <code>get</code>, <code>post</code>, <code>put</code>, <code>del</code>, or <code>ws</code> methods defined in <code>estuary-rpc-common</code> to define the metadata about the given REST or WS endpoint definitions - most importantly the URL at which the endpoint will be accessed, but also any other metadata/auth requirements/upload definitions should go here. For Example:</li>
</ul>
<pre><code><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-5">exampleApiMeta</span><span class="hl-1">: </span><span class="hl-4">ExampleApi</span><span class="hl-1">&lt;</span><span class="hl-4">never</span><span class="hl-1">, </span><span class="hl-4">ExampleMeta</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">  </span><span class="hl-0">foo:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">emptyPost:</span><span class="hl-1"> </span><span class="hl-6">post</span><span class="hl-1">(</span><span class="hl-7">&quot;foo/emptyPost&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-0">simpleGet:</span><span class="hl-1"> </span><span class="hl-6">get</span><span class="hl-1">(</span><span class="hl-7">&quot;foo/simpleGet&quot;</span><span class="hl-1">, { </span><span class="hl-0">needsAuth:</span><span class="hl-1"> </span><span class="hl-3">true</span><span class="hl-1"> }),</span><br/><span class="hl-1">    </span><span class="hl-0">simpleStream:</span><span class="hl-1"> </span><span class="hl-6">ws</span><span class="hl-1">(</span><span class="hl-7">&quot;foo/simpleStream&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-0">fileUpload:</span><span class="hl-1"> </span><span class="hl-6">post</span><span class="hl-1">(</span><span class="hl-7">&quot;fileUpload&quot;</span><span class="hl-1">, { </span><span class="hl-0">uploads:</span><span class="hl-1"> [</span><span class="hl-7">&quot;someFile.txt&quot;</span><span class="hl-1">] }),</span><br/><span class="hl-1">};</span>
</code></pre>

<a href="#usage---client" id="usage---client" style="color: inherit; text-decoration: none;">
  <h3>Usage - Client</h3>
</a>
<p>From the clientside, it is necessary merely to <code>import { convertApiClient, FetchOptsArg } from &quot;estuary-rpc-client&quot;;</code> and import your common definitions, and you will be able to create an instantion of your Api type with callable rpc methods:</p>
<pre><code><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-5">client</span><span class="hl-1"> = </span><span class="hl-6">convertApiClient</span><span class="hl-1">(</span><span class="hl-0">exampleApiMeta</span><span class="hl-1">) </span><span class="hl-2">as</span><span class="hl-1"> </span><span class="hl-4">ExampleApi</span><span class="hl-1">&lt;</span><span class="hl-4">FetchOptsArg</span><span class="hl-1">, </span><span class="hl-4">unknown</span><span class="hl-1">&gt;;</span>
</code></pre>
<p><code>FetchOptsArg</code> serves as the closure to the individual calls, should it be necessary to add additional calling options such as a timeout. The methods can then be called with</p>
<ul>
<li><code>await client.foo.emptyPost()</code> to send an empty post message</li>
<li><code>const res = await client.foo.simpleGet(4);</code> to retrieve a number response from the server</li>
<li><code>const res = await client.foo.simpleGet(4, {timeout: 1000});</code> to set a timeout on that fetch call</li>
<li>Streaming is a bit more complicated, but I have tried to make it as straightforward as possible -</li>
</ul>
<pre><code><span class="hl-2">import</span><span class="hl-1"> { </span><span class="hl-0">openStreamHandler</span><span class="hl-1"> } </span><span class="hl-2">from</span><span class="hl-1"> </span><span class="hl-7">&quot;estuary-rpc&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-5">streamHandler</span><span class="hl-1"> = </span><span class="hl-2">await</span><span class="hl-1"> </span><span class="hl-6">openStreamHandler</span><span class="hl-1">(</span><span class="hl-0">client</span><span class="hl-1">.</span><span class="hl-0">foo</span><span class="hl-1">.</span><span class="hl-0">simpleStream</span><span class="hl-1">);</span><br/><br/><span class="hl-0">streamHandler</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-7">&quot;message&quot;</span><span class="hl-1">, (</span><span class="hl-0">val</span><span class="hl-1">: </span><span class="hl-4">boolean</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><br/><span class="hl-1">  </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-7">&quot;Got message from server&quot;</span><span class="hl-1">, </span><span class="hl-0">val</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-0">streamHandler</span><span class="hl-1">.</span><span class="hl-6">close</span><span class="hl-1">()</span><br/><span class="hl-1">);</span><br/><span class="hl-0">streamHandler</span><span class="hl-1">.</span><span class="hl-6">write</span><span class="hl-1">(</span><span class="hl-7">&quot;yooo&quot;</span><span class="hl-1">);</span>
</code></pre>
<ul>
<li><code>openStreamHandler</code> serves as a bit of a simplification of the underlying use of the RPC method, which works natively like so:</li>
</ul>
<pre><code><span class="hl-2">import</span><span class="hl-1"> { </span><span class="hl-0">Duplex</span><span class="hl-1"> } </span><span class="hl-2">from</span><span class="hl-1"> </span><span class="hl-7">&quot;estuary-rpc&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-5">duplex</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-6">Duplex</span><span class="hl-1">&lt;</span><span class="hl-4">string</span><span class="hl-1">, </span><span class="hl-4">boolean</span><span class="hl-1">&gt;();</span><br/><span class="hl-2">await</span><span class="hl-1"> </span><span class="hl-0">client</span><span class="hl-1">.</span><span class="hl-0">foo</span><span class="hl-1">.</span><span class="hl-6">simpleStream</span><span class="hl-1">(</span><span class="hl-0">duplex</span><span class="hl-1">);</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-5">streamHandler</span><span class="hl-1"> = </span><span class="hl-0">duplex</span><span class="hl-1">.</span><span class="hl-0">client</span><span class="hl-1">;</span><br/><span class="hl-0">streamHandler</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-7">&quot;message&quot;</span><span class="hl-1">, (</span><span class="hl-0">val</span><span class="hl-1">: </span><span class="hl-4">boolean</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-7">&quot;Got message from server&quot;</span><span class="hl-1">, </span><span class="hl-0">val</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-0">simpleStream</span><span class="hl-1">.</span><span class="hl-6">close</span><span class="hl-1">()</span><br/><span class="hl-1">});</span><br/><span class="hl-0">streamHandler</span><span class="hl-1">.</span><span class="hl-6">write</span><span class="hl-1">(</span><span class="hl-7">&quot;yooo&quot;</span><span class="hl-1">);</span>
</code></pre>

<a href="#usage---server" id="usage---server" style="color: inherit; text-decoration: none;">
  <h3>Usage - Server</h3>
</a>
<p>On the serverside, you need to instantiate an object that implements your Api with an ApiContext closure (so your endpoints can have access to the raw request/response and helper error methods) and an unknown metadata:</p>
<pre><code><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-5">server</span><span class="hl-1">: </span><span class="hl-4">ExampleApi</span><span class="hl-1">&lt;</span><span class="hl-4">ApiContext</span><span class="hl-1">, </span><span class="hl-4">unknown</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">  </span><span class="hl-0">foo:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">emptyPost</span><span class="hl-0">:</span><span class="hl-1"> </span><span class="hl-3">async</span><span class="hl-1"> () </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-7">&quot;got post&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-6">simpleGet</span><span class="hl-0">:</span><span class="hl-1"> </span><span class="hl-3">async</span><span class="hl-1"> (</span><span class="hl-0">num</span><span class="hl-1">: </span><span class="hl-4">number</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> </span><span class="hl-8">4</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">simpleStream</span><span class="hl-0">:</span><span class="hl-1"> </span><span class="hl-3">async</span><span class="hl-1"> ({ </span><span class="hl-0">server</span><span class="hl-1"> }: </span><span class="hl-4">Duplex</span><span class="hl-1">&lt;</span><span class="hl-4">string</span><span class="hl-1">, </span><span class="hl-4">boolean</span><span class="hl-1">&gt;) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">server</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-7">&quot;message&quot;</span><span class="hl-1">, (</span><span class="hl-0">input</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-7">&quot;Got message&quot;</span><span class="hl-1">, </span><span class="hl-0">input</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">server</span><span class="hl-1">.</span><span class="hl-6">write</span><span class="hl-1">(</span><span class="hl-0">input</span><span class="hl-1"> === </span><span class="hl-7">&quot;foo&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  } </span><span class="hl-2">as</span><span class="hl-1"> </span><span class="hl-4">FooService</span><span class="hl-1">&lt;</span><span class="hl-4">ApiContext</span><span class="hl-1">, </span><span class="hl-4">unknown</span><span class="hl-1">&gt;,</span><br/><br/><span class="hl-1">  </span><span class="hl-6">fileUpload</span><span class="hl-0">:</span><span class="hl-1"> (</span><span class="hl-0">_1</span><span class="hl-1">: </span><span class="hl-4">void</span><span class="hl-1">, </span><span class="hl-0">_2</span><span class="hl-1">: </span><span class="hl-4">ApiContext</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">return</span><span class="hl-1"> </span><span class="hl-3">null</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">};</span>
</code></pre>
<p>Likely, of course, your individual services will be defined in separate files and/or directories, but they all still need to come together at the end. </p>
<p>After you have a server object, to actually run it in such a way as to respond correctly to REST and WS connections, you simply need to <code>import { createApiServer } from &quot;estuary-rpc-server&quot;;</code> and call it with your server definition and api metadata definition, as well as the port number on which you want to serve it</p>
<pre><code><span class="hl-6">createApiServer</span><span class="hl-1">(</span><span class="hl-0">server</span><span class="hl-1">, </span><span class="hl-0">exampleApiMeta</span><span class="hl-1">, { </span><span class="hl-0">port:</span><span class="hl-1"> </span><span class="hl-8">8888</span><span class="hl-1">});</span>
</code></pre>
<p>and the server will listen correctly!</p>

<a href="#metadata-amp-middleware" id="metadata-amp-middleware" style="color: inherit; text-decoration: none;">
  <h2>Metadata &amp; Middleware</h2>
</a>
<p>Each endpoint must also have metadata associated with it, which is accessible from the clientside or through your ApiDefinition object. This metadata must extend the SimpleMeta interface defined in common/api.ts</p>
<pre><code><span class="hl-3">interface</span><span class="hl-1"> </span><span class="hl-4">SimpleMeta</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">method</span><span class="hl-1">: </span><span class="hl-4">Method</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">url</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">transport</span><span class="hl-1">?: </span><span class="hl-4">Transport</span><span class="hl-1">&lt;</span><span class="hl-4">unknown</span><span class="hl-1">, </span><span class="hl-4">unknown</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><span class="hl-0">authentication</span><span class="hl-1">?: </span><span class="hl-4">Authentication</span><span class="hl-1">;</span><br/><br/><span class="hl-1">  </span><span class="hl-9">// Used for OpenAPI docs</span><br/><span class="hl-1">  </span><span class="hl-0">example</span><span class="hl-1">?: [</span><span class="hl-10">reqBody</span><span class="hl-1">: </span><span class="hl-4">unknown</span><span class="hl-1">, </span><span class="hl-10">resBody</span><span class="hl-1">: </span><span class="hl-4">unknown</span><span class="hl-1">];</span><br/><span class="hl-1">  </span><span class="hl-0">reqSchema</span><span class="hl-1">?: </span><span class="hl-4">Schema</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">resSchema</span><span class="hl-1">?: </span><span class="hl-4">Schema</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">summary</span><span class="hl-1">?: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">description</span><span class="hl-1">?: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">swagger</span><span class="hl-1">?: </span><span class="hl-4">Record</span><span class="hl-1">&lt;</span><span class="hl-4">string</span><span class="hl-1">, </span><span class="hl-4">unknown</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">}</span>
</code></pre>
<p>These are defined for you automatically as you construct your ApiDefinition with the get/post/put/del/ws objects, although it is possible to override the transport and authentication values on a per-endpoint basis. If you want to use openApi, you will likely additionally want to define values for some of those fields. Lastly, it is possible to extend SimpleMeta with your own data, so you can annotate the interface however you want. After annotating the interface however you want, you may want to act upon that data - </p>
<ul>
<li>On the client side, the apiClient that is created by <code>createApiClient</code> will have the metadata in the same object that you use as a function for communicating with the backend:</li>
</ul>
<pre><code><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-5">client</span><span class="hl-1"> = </span><span class="hl-6">createApiClient</span><span class="hl-1">(</span><span class="hl-0">myApiDef</span><span class="hl-1">);</span><br/><span class="hl-9">// prints out &quot;Calling GET /foo/bar&quot;</span><br/><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-7">`Calling </span><span class="hl-3">${</span><span class="hl-0">client</span><span class="hl-11">.</span><span class="hl-0">fooService</span><span class="hl-11">.</span><span class="hl-0">bar</span><span class="hl-11">.</span><span class="hl-0">method</span><span class="hl-3">}</span><span class="hl-7">: </span><span class="hl-3">${</span><span class="hl-0">client</span><span class="hl-11">.</span><span class="hl-0">fooService</span><span class="hl-11">.</span><span class="hl-0">bar</span><span class="hl-11">.</span><span class="hl-0">url</span><span class="hl-3">}</span><span class="hl-7">`</span><span class="hl-1">);</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-5">result</span><span class="hl-1"> = </span><span class="hl-2">await</span><span class="hl-1"> </span><span class="hl-0">client</span><span class="hl-1">.</span><span class="hl-0">fooService</span><span class="hl-1">.</span><span class="hl-6">bar</span><span class="hl-1">();</span>
</code></pre>
<ul>
<li>On the serverside, you can define middlewares passed into the <code>createApiServer</code> method which will act before every endpoint gets called, and be able to determine whether to execute the endpoint:</li>
</ul>
<pre><code><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-5">serverDef</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-0">fooService:</span><span class="hl-1"> { </span><span class="hl-6">bar</span><span class="hl-0">:</span><span class="hl-1"> () </span><span class="hl-3">=&gt;</span><span class="hl-1"> </span><span class="hl-7">&quot;cool&quot;</span><span class="hl-1">}</span><br/><span class="hl-1">};</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-6">myMiddleware</span><span class="hl-1"> = (</span><span class="hl-0">context</span><span class="hl-1">: </span><span class="hl-4">ApiContex</span><span class="hl-1">, </span><span class="hl-0">meta</span><span class="hl-1">: </span><span class="hl-4">SimpleMeta</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-9">// block all requests from Jeff;</span><br/><span class="hl-1">  </span><span class="hl-2">if</span><span class="hl-1">(</span><span class="hl-0">context</span><span class="hl-1">.</span><span class="hl-0">authentication</span><span class="hl-1">?.</span><span class="hl-0">username</span><span class="hl-1"> !== </span><span class="hl-7">&quot;Jeff&quot;</span><span class="hl-1"> || </span><span class="hl-0">meta</span><span class="hl-1">.</span><span class="hl-0">url</span><span class="hl-1">.</span><span class="hl-6">contains</span><span class="hl-1">(</span><span class="hl-7">&quot;Jeff&quot;</span><span class="hl-1">)) {</span><br/><span class="hl-1">    </span><span class="hl-0">context</span><span class="hl-1">.</span><span class="hl-6">badRequest</span><span class="hl-1">(</span><span class="hl-7">&quot;No Jeff&#39;s allowed&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-2">return</span><span class="hl-1"> </span><span class="hl-3">false</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-2">return</span><span class="hl-1"> </span><span class="hl-3">true</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><span class="hl-6">createApiServer</span><span class="hl-1">(</span><span class="hl-0">serverDef</span><span class="hl-1">, </span><span class="hl-0">myApiDef</span><span class="hl-1">, { </span><span class="hl-0">middlewares:</span><span class="hl-1"> [</span><span class="hl-0">myMiddleware</span><span class="hl-1">]});</span>
</code></pre>

<a href="#transport-metadata" id="transport-metadata" style="color: inherit; text-decoration: none;">
  <h3>Transport Metadata</h3>
</a>
<p>The transport metadata determines the method by which the arguments to the endpoint function are encoded for underlying representation. They should be one of the following:</p>
<pre><code><span class="hl-9">// Default transport used</span><br/><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-3">type</span><span class="hl-1"> </span><span class="hl-4">JsonTransport</span><span class="hl-1"> = { </span><span class="hl-0">transportType</span><span class="hl-1">: </span><span class="hl-4">TransportType</span><span class="hl-1">.</span><span class="hl-4">JSON</span><span class="hl-1"> };</span><br/><br/><span class="hl-9">// Encode request values in the queryString, with most values still JSON encoded and put there</span><br/><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-3">type</span><span class="hl-1"> </span><span class="hl-4">UrlFormTransport</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-0">transportType</span><span class="hl-1">: </span><span class="hl-4">TransportType</span><span class="hl-1">.</span><span class="hl-4">URL_FORM_DATA</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-9">// set this to true to treat it as a Record&lt;string, string&gt; instead of trying to parse as JSON</span><br/><span class="hl-1">  </span><span class="hl-0">rawStrings</span><span class="hl-1">?: </span><span class="hl-4">boolean</span><span class="hl-1">;</span><br/><span class="hl-1">};</span><br/><span class="hl-9">// Encode request values in multipart/form-data, should be used for any file transmission</span><br/><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-3">type</span><span class="hl-1"> </span><span class="hl-4">MultipartFormTransport</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-0">transportType</span><span class="hl-1">: </span><span class="hl-4">TransportType</span><span class="hl-1">.</span><span class="hl-4">MULTIPART_FORM_DATA</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-9">// set true to persist data to disk instead of just parsing it after the fact</span><br/><span class="hl-1">  </span><span class="hl-0">persist</span><span class="hl-1">?: </span><span class="hl-4">boolean</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-9">// set this to true to treat it as a Record&lt;string, string&gt; instead of trying to parse as JSON</span><br/><span class="hl-1">  </span><span class="hl-0">rawStrings</span><span class="hl-1">?: </span><span class="hl-4">boolean</span><span class="hl-1">;</span><br/><span class="hl-1">};</span><br/><span class="hl-9">// Build your own Transport! Must provide definitions for encoding and decoding the Req and Res types</span><br/><span class="hl-9">// to Uint8Array.</span><br/><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-3">type</span><span class="hl-1"> </span><span class="hl-4">UnknownBinaryTransport</span><span class="hl-1">&lt;</span><span class="hl-4">Req</span><span class="hl-1">, </span><span class="hl-4">Res</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">  </span><span class="hl-0">transportType</span><span class="hl-1">: </span><span class="hl-4">TransportType</span><span class="hl-1">.</span><span class="hl-4">UNKNOWN</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">isBinary</span><span class="hl-1">: </span><span class="hl-4">true</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">contentType</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">encode</span><span class="hl-1">: </span><span class="hl-4">Encoder</span><span class="hl-1">&lt;</span><span class="hl-4">Req</span><span class="hl-1">, </span><span class="hl-4">Res</span><span class="hl-1">, </span><span class="hl-4">WsData</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><span class="hl-0">decode</span><span class="hl-1">: </span><span class="hl-4">Decoder</span><span class="hl-1">&lt;</span><span class="hl-4">Req</span><span class="hl-1">, </span><span class="hl-4">Res</span><span class="hl-1">, </span><span class="hl-4">WsData</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">};</span><br/><span class="hl-9">// Build your own Transport! Must provide definitions for encoding and decoding the Req and Res types</span><br/><span class="hl-9">// to string.</span><br/><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-3">type</span><span class="hl-1"> </span><span class="hl-4">UknownStringTransport</span><span class="hl-1">&lt;</span><span class="hl-4">Req</span><span class="hl-1">, </span><span class="hl-4">Res</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">  </span><span class="hl-0">transportType</span><span class="hl-1">: </span><span class="hl-4">TransportType</span><span class="hl-1">.</span><span class="hl-4">UNKNOWN</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">isBinary</span><span class="hl-1">: </span><span class="hl-4">false</span><span class="hl-1"> | </span><span class="hl-4">undefined</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">contentType</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">encode</span><span class="hl-1">: </span><span class="hl-4">Encoder</span><span class="hl-1">&lt;</span><span class="hl-4">Req</span><span class="hl-1">, </span><span class="hl-4">Res</span><span class="hl-1">, </span><span class="hl-4">WsData</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><span class="hl-0">decode</span><span class="hl-1">: </span><span class="hl-4">Decoder</span><span class="hl-1">&lt;</span><span class="hl-4">Req</span><span class="hl-1">, </span><span class="hl-4">Res</span><span class="hl-1">, </span><span class="hl-4">WsData</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">};</span>
</code></pre>

<a href="#authentication-metadata" id="authentication-metadata" style="color: inherit; text-decoration: none;">
  <h3>Authentication Metadata</h3>
</a>
<p>It is fairly straightforward to build your own authentication process, but there are builtins for simple Basic, Bearer, Cookie, query param, and custom header-based authentication schemas, that encode authentication values passed into the <code>createApiClient</code> into the logical parts of the request and in turn parse those values at the server side. Authentication Metadata must look like one of these:</p>
<pre><code><br/><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-3">type</span><span class="hl-1"> </span><span class="hl-4">BasicAuth</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-0">type</span><span class="hl-1">: </span><span class="hl-7">&quot;basic&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">username</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">password</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">};</span><br/><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-3">type</span><span class="hl-1"> </span><span class="hl-4">BearerAuth</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-0">type</span><span class="hl-1">: </span><span class="hl-7">&quot;bearer&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">token</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">};</span><br/><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-3">type</span><span class="hl-1"> </span><span class="hl-4">HeaderAuth</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-0">type</span><span class="hl-1">: </span><span class="hl-7">&quot;header&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">keyPair</span><span class="hl-1">: [</span><span class="hl-4">string</span><span class="hl-1">, </span><span class="hl-4">string</span><span class="hl-1">] | [</span><span class="hl-4">string</span><span class="hl-1">];</span><br/><span class="hl-1">};</span><br/><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-3">type</span><span class="hl-1"> </span><span class="hl-4">QueryAuth</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-0">type</span><span class="hl-1">: </span><span class="hl-7">&quot;query&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">keyPair</span><span class="hl-1">: [</span><span class="hl-4">string</span><span class="hl-1">, </span><span class="hl-4">string</span><span class="hl-1">] | [</span><span class="hl-4">string</span><span class="hl-1">];</span><br/><span class="hl-1">};</span><br/><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-3">type</span><span class="hl-1"> </span><span class="hl-4">CookieAuth</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-0">type</span><span class="hl-1">: </span><span class="hl-7">&quot;cookie&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">keyPair</span><span class="hl-1">: [</span><span class="hl-4">string</span><span class="hl-1">, </span><span class="hl-4">string</span><span class="hl-1">] | [</span><span class="hl-4">string</span><span class="hl-1">];</span><br/><span class="hl-1">};</span>
</code></pre>
<p>Note that when specifying the metadata, it is necessary to put in a value for some of those secrets - this is just done to make it easier to reuse the types, and an empty string will not make a functional difference.</p>
<p>Usage would be as follows:</p>
<pre><code><span class="hl-3">interface</span><span class="hl-1"> </span><span class="hl-4">MyApi</span><span class="hl-1">&lt;</span><span class="hl-4">Closure</span><span class="hl-1">, </span><span class="hl-4">Meta</span><span class="hl-1">&gt; </span><span class="hl-3">extends</span><span class="hl-1"> </span><span class="hl-4">Api</span><span class="hl-1">&lt;</span><span class="hl-4">Closure</span><span class="hl-1">, </span><span class="hl-4">Meta</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-0">foo</span><span class="hl-1">: </span><span class="hl-4">EndpointDesc</span><span class="hl-1">&lt;</span><span class="hl-4">string</span><span class="hl-1">, </span><span class="hl-4">string</span><span class="hl-1">, </span><span class="hl-4">Closure</span><span class="hl-1">, </span><span class="hl-4">Meta</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><span class="hl-0">bar</span><span class="hl-1">: </span><span class="hl-4">EndpointDesc</span><span class="hl-1">&lt;</span><span class="hl-4">string</span><span class="hl-1">, </span><span class="hl-4">string</span><span class="hl-1">, </span><span class="hl-4">Closure</span><span class="hl-1">, </span><span class="hl-4">Meta</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">}</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-5">myApiDef</span><span class="hl-1">: </span><span class="hl-4">MyApi</span><span class="hl-1">&lt;</span><span class="hl-4">unknown</span><span class="hl-1">, </span><span class="hl-4">SimpleMeta</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">  </span><span class="hl-0">foo:</span><span class="hl-1"> </span><span class="hl-6">get</span><span class="hl-1">(</span><span class="hl-7">&#39;foo&#39;</span><span class="hl-1">, { </span><span class="hl-0">authentication:</span><span class="hl-1"> { </span><span class="hl-0">type:</span><span class="hl-1"> </span><span class="hl-7">&#39;basic&#39;</span><span class="hl-1">, </span><span class="hl-0">username:</span><span class="hl-1"> </span><span class="hl-7">&#39;&#39;</span><span class="hl-1">, </span><span class="hl-0">password:</span><span class="hl-1"> </span><span class="hl-7">&#39;&#39;</span><span class="hl-1">}}),</span><br/><span class="hl-1">  </span><span class="hl-0">bar:</span><span class="hl-1"> </span><span class="hl-6">get</span><span class="hl-1">(</span><span class="hl-7">&#39;bar&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-3">function</span><span class="hl-1"> </span><span class="hl-6">createMyApiClient</span><span class="hl-1">(</span><span class="hl-0">currentAuthState</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-2">return</span><span class="hl-1"> </span><span class="hl-6">createApiClient</span><span class="hl-1">(</span><span class="hl-0">myApiDef</span><span class="hl-1">, { </span><span class="hl-0">authentication:</span><span class="hl-1"> </span><span class="hl-0">currentAuthState</span><span class="hl-1"> });</span><br/><span class="hl-1">}</span><br/><span class="hl-1">...</span><br/><br/><span class="hl-3">function</span><span class="hl-1"> </span><span class="hl-6">authenticate</span><span class="hl-1">(</span><span class="hl-0">auth</span><span class="hl-1">: </span><span class="hl-4">Authentication</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-2">if</span><span class="hl-1"> (</span><span class="hl-0">auth</span><span class="hl-1">.</span><span class="hl-0">type</span><span class="hl-1"> === </span><span class="hl-7">&quot;basic&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-2">return</span><span class="hl-1"> </span><span class="hl-0">auth</span><span class="hl-1">.</span><span class="hl-0">username</span><span class="hl-1"> === </span><span class="hl-7">&quot;blah&quot;</span><span class="hl-1"> &amp;&amp; </span><span class="hl-0">auth</span><span class="hl-1">.</span><span class="hl-0">password</span><span class="hl-1"> === </span><span class="hl-7">&quot;blah&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  } </span><span class="hl-2">else</span><span class="hl-1"> </span><span class="hl-2">if</span><span class="hl-1"> (</span><span class="hl-0">auth</span><span class="hl-1">.</span><span class="hl-0">type</span><span class="hl-1"> === </span><span class="hl-7">&quot;query&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-9">// perform default authentication on all endpoints not otherwise specified</span><br/><span class="hl-1">    </span><span class="hl-9">// only allowing requests with ?queryKey=awesome</span><br/><span class="hl-1">    </span><span class="hl-2">return</span><span class="hl-1"> </span><span class="hl-0">auth</span><span class="hl-1">.</span><span class="hl-0">keyPair</span><span class="hl-1">[</span><span class="hl-8">1</span><span class="hl-1">] === </span><span class="hl-7">&quot;awesome&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><span class="hl-6">createApiServer</span><span class="hl-1">(</span><span class="hl-0">serverDefs</span><span class="hl-1">, </span><span class="hl-0">myApiDef</span><span class="hl-1">, { </span><span class="hl-0">defaultAuthentication:</span><span class="hl-1"> { </span><span class="hl-0">type:</span><span class="hl-1"> </span><span class="hl-7">&#39;query&#39;</span><span class="hl-1">, </span><span class="hl-0">keyPair:</span><span class="hl-1"> [</span><span class="hl-7">&#39;queryKey&#39;</span><span class="hl-1">] } })</span>
</code></pre>

<a href="#openapi" id="openapi" style="color: inherit; text-decoration: none;">
  <h3>OpenAPI</h3>
</a>
<p>The format of the metadata that you need to generate for Estuary is already pretty close to what is necessary for an OpenApi spec, which has a good amount of tooling around it - so Estuary provides a <code>createOpenApiSpec</code> method. Minimal usage is possible by simply calling</p>
<pre><code><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-5">spec</span><span class="hl-1"> = </span><span class="hl-6">createOpenApiSpec</span><span class="hl-1">(</span><span class="hl-0">exampleApiMeta</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-0">info:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">title:</span><span class="hl-1"> </span><span class="hl-7">&quot;Example API&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">version:</span><span class="hl-1"> </span><span class="hl-7">&quot;foo.bar&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code></pre>
<p>and using that resultant spec in tooling provided by the swagger-ui, swagger-ui-react, or swagger-ui-dist tools. Arbitrary JSON can be added to the second argument to extend the generated spec with additional OpenApi tooling, 
such as custom components or servers, etc - <a href="https://swagger.io/docs/specification/basic-structure/">more details here</a>. Additionally, it is possible to provide specific endpoint-level metadata in your api definition, of the type</p>
<pre><code><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-9">// Simplest way to do it, provide example request/responses and Estuary will put forth a minimal description</span><br/><span class="hl-1">  </span><span class="hl-9">// of those types in a friendly way for OpenApi</span><br/><span class="hl-1">  </span><span class="hl-0">example</span><span class="hl-1">?: [</span><span class="hl-0">reqBody</span><span class="hl-1">: </span><span class="hl-0">unknown</span><span class="hl-1">, </span><span class="hl-0">resBody</span><span class="hl-1">: </span><span class="hl-0">unknown</span><span class="hl-1">];</span><br/><span class="hl-1">  </span><span class="hl-9">// Or just give proper descriptions of the Request and Response types according to the [Schema Object](https://github.com/OAI/OpenAPI-Specification/blob/main/versions/3.0.3.md#schemaObject) definition</span><br/><span class="hl-1">  </span><span class="hl-9">// Small note here - Estuary will automatically convert a Request object definition to a list of parameters</span><br/><span class="hl-1">  </span><span class="hl-9">// if the encoding type is URL_FORM_ENCODED</span><br/><span class="hl-1">  </span><span class="hl-0">reqSchema</span><span class="hl-1">?: </span><span class="hl-0">Schema</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">resSchema</span><span class="hl-1">?: </span><span class="hl-0">Schema</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">summary</span><span class="hl-1">?: </span><span class="hl-0">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">description</span><span class="hl-1">?: </span><span class="hl-0">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-9">// Or just give a proper description of the entire endpoint. Hopefully the fields above are easier to use and </span><br/><span class="hl-1">  </span><span class="hl-9">// almost fully functional</span><br/><span class="hl-1">  </span><span class="hl-0">swagger</span><span class="hl-1">?: </span><span class="hl-0">Record</span><span class="hl-1">&lt;</span><span class="hl-0">string</span><span class="hl-1">, </span><span class="hl-0">unknown</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">}</span>
</code></pre>
<p>See the example client for an example of use</p>

<a href="#streams" id="streams" style="color: inherit; text-decoration: none;">
  <h2>Streams</h2>
</a>
<p>Streaming data is handled via websockets and ends up working a bit differently to the rest of the requests:</p>
<ul>
<li>Basic, Bearer, and Header authentication schemes won&#39;t work, as you can&#39;t pass headers into a websocket request from the browser</li>
<li>URL_FORM_DATA and MULTIPART_FORM_DATA transports are not supported for what should be fairly clear reasons</li>
<li>Instead of conceptualizing the endpoint as a thing that takes in a request and returns a response, the endpoints are reprented as unary functions that take in a Duplex which can be read from and written to (and have events attatched)</li>
</ul>
<p>The Duplex object used in these functions contains two streams: <code>toServer</code> and <code>toClient</code>, representing the streams of data flowing to the server and to the client, respectively. They are probably easiest to interact with via the StreamHandlers though, which have methods for writing in one direction and reading from the other. That is, when on the client side you do:</p>
<pre><code><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-5">streamHandler</span><span class="hl-1"> = </span><span class="hl-2">await</span><span class="hl-1"> </span><span class="hl-6">openStreamHandler</span><span class="hl-1">(</span><span class="hl-0">client</span><span class="hl-1">.</span><span class="hl-0">foo</span><span class="hl-1">.</span><span class="hl-0">simpleStream</span><span class="hl-1">);</span><br/><br/><span class="hl-0">streamHandler</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-7">&quot;message&quot;</span><span class="hl-1">, (</span><span class="hl-0">val</span><span class="hl-1">: </span><span class="hl-4">boolean</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><br/><span class="hl-1">  </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-7">&quot;Got message from server&quot;</span><span class="hl-1">, </span><span class="hl-0">val</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-0">streamHandler</span><span class="hl-1">.</span><span class="hl-6">write</span><span class="hl-1">(</span><span class="hl-7">&quot;up&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-0">streamHandler</span><span class="hl-1">.</span><span class="hl-6">close</span><span class="hl-1">()</span><br/><span class="hl-1">);</span>
</code></pre>
<p>The returned streamHandler is the client representation of a duplex created and passed to <code>client.foo.simpleStream</code>, with the message event triggering <strong>on messages from the server</strong> and the streamHandler.write event being encoded and sent in the websocket stream to the server (and the close event, in turn terminating the WS connection).</p>
<p>Likewise on the server, when you define a method it is easiest to do something like</p>
<pre><code><span class="hl-10">simpleStream</span><span class="hl-1">: </span><span class="hl-3">async</span><span class="hl-1"> ({ </span><span class="hl-0">server</span><span class="hl-1"> }: </span><span class="hl-4">Duplex</span><span class="hl-1">&lt;</span><span class="hl-4">string</span><span class="hl-1">, </span><span class="hl-4">boolean</span><span class="hl-1">&gt;) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">server</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-7">&quot;message&quot;</span><span class="hl-1">, (</span><span class="hl-0">input</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-7">&quot;Got message&quot;</span><span class="hl-1">, </span><span class="hl-0">input</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">server</span><span class="hl-1">.</span><span class="hl-6">write</span><span class="hl-1">(</span><span class="hl-0">input</span><span class="hl-1"> === </span><span class="hl-7">&quot;foo&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">},</span>
</code></pre>
<p>Where the server view of the duplex is reading from the client and writing to the server. Because the high-level design of Estuary is such that the type of the method should be the same on the client as on the server, you technically must have access to the same interface on both sides - but accessing the client interface on the server or vice versa will result in messages being written to streams that don&#39;t otherwise have listeners on them (and vice versa).</p>
</div></div>
<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
<div class="tsd-navigation settings">
<details class="tsd-index-accordion"><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Settings</h3></summary>
<div class="tsd-accordion-details">
<div class="tsd-filter-visibility">
<h4 class="uppercase">Member Visibility</h4><form>
<ul id="tsd-filter-options">
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div>
<div class="tsd-theme-toggle">
<h4 class="uppercase">Theme</h4><select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div>
<nav class="tsd-navigation primary">
<details class="tsd-index-accordion" open><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Modules</h3></summary>
<div class="tsd-accordion-details">
<ul>
<li class="current selected"><a href="modules.html">estuary-<wbr/>rpc-<wbr/>proj</a>
<ul>
<li class="tsd-kind-module"><a href="modules/estuary_rpc.html">estuary-<wbr/>rpc</a></li>
<li class="tsd-kind-module"><a href="modules/estuary_rpc_client.html">estuary-<wbr/>rpc-<wbr/>client</a></li>
<li class="tsd-kind-module"><a href="modules/estuary_rpc_server.html">estuary-<wbr/>rpc-<wbr/>server</a></li></ul></li></ul></div></details></nav></div></div>
<div class="container tsd-generator">
<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div>
<div class="overlay"></div><script src="assets/main.js"></script></body></html>